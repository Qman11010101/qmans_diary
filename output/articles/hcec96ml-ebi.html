<!DOCTYPE html>
<html>

<head prefix="og:http://ogp.me/ns#">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>【備忘録】今（22.10以降）のUbuntuはsshd_configを変更するだけではSSHポートを変更できない - Qman's Diary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Open Graph (OGP) Meta Tags -->
    <meta property="og:title" content="【備忘録】今（22.10以降）のUbuntuはsshd_configを変更するだけではSSHポートを変更できない - Qman's Diary">
    <meta property="og:description" content="久々にOracle Cloudで無料枠のUbuntuサーバーを作り直していたらドハマリしたので、備忘録を残す。問題の概要環境Ubuntu 22.10以降（投稿時点で言うと22.10、23.04、23.…">
    <meta property="og:url" content="https://blog.qmainconts.dev/articles/hcec96ml-ebi.html">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Qman's Diary">
    <meta property="og:image" content="https://blog.qmainconts.dev/assets/icon_large.png">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Cards Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="【備忘録】今（22.10以降）のUbuntuはsshd_configを変更するだけではSSHポートを変更できない - Qman's Diary">
    <meta name="twitter:description" content="久々にOracle Cloudで無料枠のUbuntuサーバーを作り直していたらドハマリしたので、備忘録を残す。問題の概要環境Ubuntu 22.10以降（投稿時点で言うと22.10、23.04、23.…">
    <meta name="twitter:url" content="https://blog.qmainconts.dev/articles/hcec96ml-ebi.html">
    <meta name="twitter:site" content="@QmanEnobikto">

    <!-- その他 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" fetchpriority="high" href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code&family=Noto+Sans+JP:wght@400;700&family=Play:wght@700&family=Source+Code+Pro&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code&family=Noto+Sans+JP:wght@400;700&family=Play:wght@700&family=Source+Code+Pro&display=swap" media="print" onload='this.media="all"' />
    <link rel="stylesheet" href="/assets/css/reset.css">
    <link rel="stylesheet" href="/assets/css/common.css?b=1753334094">
    <link rel="stylesheet" href="/assets/css/article.css?b=1753334094">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cmake.min.js" integrity="sha512-dB3yY382soXMlcOc71s6oU9RyP+KRgMLrDBh2EOpBBbWcpNeOoHHEldKuIhrVBCjdSlD6ugRkKkDA039sWipbw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/powershell.min.js" integrity="sha512-jWH48mwjihORkGHkvD8l0E/MtDgvY0C69eaYitXkI28ZneLUso2I3PgrN8lNnF3esiwHIFy0QODZy7ypmo9Flg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/assets/js/latest_articles.js?b=1753334094"></script>
    <script src="/assets/js/categories.js?b=1753334094"></script>
    <script src="/assets/js/codeblock.js?b=1753334094"></script>
    <script src="/assets/js/time_course.js?b=1753334094"></script>
    <script src="/assets/js/toc.js?b=1753334094"></script>
    <link rel="canonical" href="https://blog.qmainconts.dev/articles/hcec96ml-ebi.html">
    <meta name="description" content="久々にOracle Cloudで無料枠のUbuntuサーバーを作り直していたらドハマリしたので、備忘録を残す。問題の概要環境Ubuntu 22.10以降（投稿時点で言うと22.10、23.04、23.…">
    <meta name="google-site-verification" content="u0BTjFYkL3nKuJ0DyWuKngSx29oQe4lkzcAgTFfP2bQ" />
</head>


<body>
<header>
    <div id="blogtitle"><a href="/">Qman's Diary</a></div>
    <p>多趣味人間の備忘録</p>
</header>
<main>
        <section id="maincol">
            <section class="box">
                <div class="date">2025-05-25 (2025-06-24 更新)</div>
                <h1 id="articletitle">【備忘録】今（22.10以降）のUbuntuはsshd_configを変更するだけではSSHポートを変更できない</h1>
                <div class="tags">
                    <div class="tag"><img src="/assets/tag.svg" alt="タグ" width="18" height="18" draggable="false"></div><div class="tag"><a href="category/tech"></a>技術</div></div><div id="time-course-warning"></div>
                <article id="atcbody"><p>久々にOracle Cloudで無料枠のUbuntuサーバーを作り直していたらドハマリしたので、備忘録を残す。</p><h2 id="h8e26fa3ff1">問題の概要</h2><h3 id="hed900658dc">環境</h3><p>Ubuntu 22.10以降（投稿時点で言うと22.10、23.04、23.10、24.04、24.10、25.04が該当すると思われる。Ubuntuのバージョンで検索する人が引っかかってほしいので列挙しておいた）</p><h3 id="ha13bae5802">起きていること</h3><p>従来、SSHポートをデフォルトの22番から変更する際は、<code>/etc/ssh/sshd_config</code>の<code>Port</code>を編集していたと思う。しかし、これを変更してsshサービスを再起動（<code>sudo systemctl restart ssh</code>）してみても、どうも22番ポートで待ち受けてしまう。</p><h3 id="hc4c05c18f9">解決策</h3><p><code>/etc/ssh/sshd_config</code>だけでなく、<code>/usr/lib/systemd/system/ssh.socket</code>も編集する必要がある。</p><h2 id="h046876a126">手順</h2><h3 id="he494d766a0">sshd_configの編集</h3><p>従来通り、<code>/etc/ssh/sshd_config</code>の<code>Port</code>を編集する。</p><h3 id="h5e6e9a2341">/usr/lib/systemd/system/ssh.socketの編集</h3><p>次に、<code>/usr/lib/systemd/system/ssh.socket</code>の以下の部分を編集する。</p><div data-filename="/usr/lib/systemd/system/ssh.socket"><pre><code class="language-plaintext">[Socket]
ListenStream=22</code></pre></div><p>この”22”をお好みのポート番号に変更する（もちろん、<code>/etc/ssh/sshd_config</code>で設定したものと同じ番号を使う必要がある）。</p><h3 id="h9323cf7bb4">daemon_reloadとsshサービスの再起動</h3><p>systemdのファイルに手を加えたので、<code>daemon-reload</code>からやる必要がある。</p><pre><code>sudo systemctl daemon-reload
sudo systemctl restart ssh</code></pre><p>これで、sshが設定したポートで待ち受けてくれるようになる。</p><p><code>systemctl status ssh</code>で確認してみるとよい。</p><h2 id="h44e51f96ce">参考資料</h2><p><a href="https://qiita.com/nouernet/items/d027da6482ca34a97927" target="_blank" rel="noopener noreferrer">【2024年12月版】Ubuntu24.04 で sshdの待ち受けポートの変更【ssh, sshd】 #SSH - Qiita</a>　参考にしてうまく行った記事。書いてある手順はほとんどここのコピペに等しい。</p><p><a href="https://dev.to/sneh27/cannot-use-a-custom-ssh-port-in-ubuntu-2210-or-above-heres-a-fix-2nhk" target="_blank" rel="noopener noreferrer nofollow">Cannot use a custom SSH port in Ubuntu 22.10 or above? Here&apos;s a fix - DEV Community</a>　微妙に違う手順が記載されているので、うまくいなかったらこっちも参照してみてほしい。</p><h2 id="he73e042638">（おまけ）もしかして: iptables</h2><p>Oracle Cloudのインスタンス上でこれをやってポートが開いてるはずなのに接続できないという人は、まずOracle Cloud側のサブネットでポートが開いているかを確認する。それでも詰まっている人は「oracle cloud iptables」とかで検索すると幸せになれるかもしれない。</p></article>
                <div class="widget-wrapper">
                    <div class="widget-child-wrapper">
                        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-lang="ja" data-show-count="false">Post</a>
                        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                    </div>
                    <div class="widget-child-wrapper">
                        <a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="touch-counter" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
                        <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
                    </div>
                    <!-- 共有まわりのロジックとCSSが全部消えてしまったのでなんとかする -->
                    <!-- <div class="widget-child-wrapper">
                        <button id="misc-share"><img src="/assets/share.svg" width="16" height="16">共有</button>
                    </div> -->
                </div>
            </section>
            <section class="box">
                <section class="widgetgroup" id="recent">
                    <div class="widgetindex">Recent Articles</div>
                    <div id="recent-articles"></div>
                </section>
            </section>
        </section>
<section id="subcol">
    <div class="box">
        <div class="subcolbtn">
            <a href="https://qmainconts.dev/"></a>
            >> キューマンのコンテンツ置き場
        </div>
        <section class="widgetgroup">
            <h3 class="widgetindex">Profile</h3>
            <p>オタクコンテンツで命を繋いでいる人間</p>
        </section>
        <section class="widgetgroup">
            <h3 class="widgetindex">Accounts</h3>
            <ul>
                <li>X: <a href="https://x.com/QmanEnobikto" target="_blank">@QmanEnobikto</a>
                </li>
                <li>GitHub: <a href="https://github.com/Qman11010101" target="_blank">Qman11010101</a></li>
                <li>Qiita: <a href="https://qiita.com/KjumanEnobikto" target="_blank">@KjumanEnobikto</a>
                </li>
                <li>Zenn: <a href="https://zenn.dev/kjumanenobikto" target="_blank">@kjumanenobikto</a></li>
                <li>カクヨム: <a href="https://kakuyomu.jp/users/QmanEnobikto" target="_blank">QmanEnobikto</a>
                </li>
            </ul>
        </section>
        <section class="widgetgroup">
            <h3 class="widgetindex">Category</h3>
            <div id="categorydisplay"></div>
        </section>
    </div>
    <nav class="box toc-side">
        <ul id="toc-side-wrapper"></ul>
    </nav>
</section>
</main>
<footer>
    <p>当ホームページに記載されている会社名・製品名・システム名などは、各社の登録商標、もしくは商標です。</p>
    <p>© 2022 Kjuman Enobikto All rights reserved.</p>
</footer>
</body>

</html>